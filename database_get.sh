#!/bin/bash
DATE_NOW=$(date +%s)
/usr/bin/psql --tuples-only -d IBSng -U ibs -c "select users.user_id from users where  (user_id in (select rel_exp_date.user_id from (select attr_value::bigint,user_id from user_attrs where attr_name='first_login') as first_login, (select attr_value::bigint,user_id from user_attrs where attr_name='rel_exp_date' union select group_attrs.attr_value::bigint,user_id from users,group_attrs where users.group_id=group_attrs.group_id and group_attrs.attr_name='rel_exp_date' and user_id not in (select user_attrs.user_id from user_attrs where user_attrs.attr_name='rel_exp_date')) as rel_exp_date where rel_exp_date.user_id=first_login.user_id and first_login.attr_value+rel_exp_date.attr_value < $DATE_NOW ))" | tr -d '[:blank:]' | sort -h
